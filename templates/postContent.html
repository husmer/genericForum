<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/static/css/main.css" />
    <title>Forum</title>
  </head>
  <body>
    <div class="container">
      <div class="container_menu">
        <a class="container_menu_button" href="/">
          <span>Forum</span>
        </a>
        {{if eq .Access.AccessRight "1" }}
        <a class="container_menu_button" href="/login">
          <span>Login</span>
        </a>
        <a class="container_menu_button" href="/register">
          <span>Register</span>
        </a>
        {{else if eq .Access.AccessRight "2"}}
        <a class="container_menu_button" href="/logout">
          <span>Logout</span>
        </a>
        
        <a class="container_menu_button" href="/post">
          <span>Create Post</span>
        </a>
        {{end}}
        <span class="container_menu_button">
          {{.User.Username}}
        </span>
      </div>
      <div class="container_content">
        <div class="container_content_categories">
          <span>Post Categories: </span>
          {{range $cat := .AllPosts}}
          {{if $cat.Categories}}
            {{range $singleCat := $cat.Categories}}
              <p class="container_content_categories_item">{{$singleCat.Category}}</p>
            {{end}}
            {{else}}
            <p>None</p>
            {{end}}
          {{end}}
        </div>
        <a href="/">
            <button class="back-button">Back to forum</button>
        </a>
        {{$item := index .AllPosts 0}}
        <p>{{$item.User}}</p>
        <p>{{$item.Title}}</p>
        <p>{{$item.Post}}</p>
        <p>{{$item.Created}}</p>
        {{if eq .Access.AccessRight "2" }}
        <form method="post" action="/postcontent?PostId={{$item.Id}}">
            <label for="createPostComment">
            <span>Create Comment</span>
            <input type="text" name="createPostComment" />
            </label>
            <input type="submit" value="Submit" />
        </form>
        {{end}}
        {{if .Errors}} 
        {{range $err := .Errors}}
          <p>{{$err}}</p>
        {{end}} 
        {{end}}
        {{if .AllComments}}
        {{range $item := .AllComments}}
        <div class="container_content_post-link_container">
          <span>{{$item.Comment}}</span>
          <span>By {{$item.UserId}}</span>
          <span>Created on: {{$item.Created}}</span>
          
          {{$postItem := index $.AllPosts 0}}
          {{if eq $.Access.AccessRight "2" }}
            <form action="/postcontent?PostId={{$postItem.Id}}" method="post">
              <label for="like">
                <input type="hidden" name="CommentId" value="{{$item.Id}}" />
                {{if eq $item.CurrUserRate "1"}}
                <input style="border: 2px solid red;" type="submit" name="like" value="Like" />
                {{else}}
                <input style="border: 2px solid transparent;" type="submit" name="like" value="Like" />
                {{end}}
              </label>
              {{end}}
              <span>Rating: {{$item.Likes}}</span>
              {{if eq $.Access.AccessRight "2" }}
              <label for="dislike">
                <input type="hidden" name="CommentId" value="{{$item.Id}}" />
                {{if eq $item.CurrUserRate "-1"}}
                <input style="border: 2px solid red;"  type="submit" name="dislike" value="Dislike" />
                {{else}}
                <input style="border: 2px solid transparent;" type="submit" name="dislike" value="Dislike" />
                {{end}}
              </label>
            </form>
            {{end}}
        </div>
        {{end}}
        
        {{else}}
        <p>No comments yet, add one today!</p>
        {{end}}
      </div>
    </div>
  </body>
</html>
